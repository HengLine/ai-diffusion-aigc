<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>配置管理 - AIGC创意平台</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            background-color: #f5f5f5;
        }
        header {
            background-color: #4a6fa5;
            color: white;
            padding: 1.5rem 0;
            text-align: center;
            margin-bottom: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        header h1 {
            margin: 0;
            font-size: 2rem;
        }
        .container {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #2c3e50;
        }
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .form-group input:focus {
            outline: none;
            border-color: #4a6fa5;
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        .form-button {
            background-color: #4a6fa5;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .form-button:hover {
            background-color: #3a5a85;
        }
        .back-link {
            display: inline-block;
            margin-top: 1rem;
            color: #4a6fa5;
            text-decoration: none;
            font-weight: 500;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .status-box {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border-color: #28a745;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }
        .info-box {
            background-color: #e3f2fd;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #1976d2;
        }
        .info-box h3 {
            margin-top: 0;
            color: #1976d2;
        }
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
            }
        }
        
        /* 参数标签样式 */
        .param-tooltip {
            position: relative;
            display: inline-block;
            margin-left: 0.5rem;
        }
        
        .param-icon {
            background-color: #4a6fa5;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: help;
        }
        
        .param-content {
            visibility: hidden;
            width: 400px;
            background-color: #2c3e50;
            color: white;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-line;
        }
        
        .param-content::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2c3e50 transparent transparent transparent;
        }
        
        .param-tooltip:hover .param-content {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- 引入公共组件 -->
    {% include 'components/header.html' %}
    {% include 'components/common_scripts.html' %}

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <script>
                    // 页面加载后显示flash消息为右下角通知
                    document.addEventListener('DOMContentLoaded', function() {
                        {% for category, message in messages %}
                            showAutoCloseNotification('{{ message | safe }}', '{{ category }}', 3000);
                        {% endfor %}
                    });
                </script>
            {% endif %}
        {% endwith %}

        <form method="post">
            <div class="info-box">
                <h3>ComfyUI配置</h3>
                <p>请输入您的ComfyUI API URL地址，这是使用AI生成功能的必要条件。</p>
            </div>
            
            <div class="form-group">
                <label for="comfyui_api_url">ComfyUI API URL <span style="color: red;">*</span></label>
                <input type="text" id="comfyui_api_url" name="comfyui_api_url" 
                       value="{{ comfyui_api_url }}" placeholder="例如：http://127.0.0.1:8188" required>
            </div>
            
            <div class="info-box" style="margin-top: 2rem;">
                <h3>用户信息</h3>
                <p>请输入您的用户信息，包括邮箱和昵称（当任务执行异常时，会通过该邮箱通知您）。</p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                
                <div class="form-group">
                    <label for="nickname">昵称 <span style="color: red;">*</span></label>
                    <input type="text" id="nickname" name="nickname" 
                           value="{{ user_nickname }}" placeholder="请输入您的用户昵称" required>
                </div>
                <div class="form-group">
                    <label for="email">电子邮箱 <span style="color: red;">*</span></label>
                    <input type="email" id="email" name="email" 
                           value="{{ user_email }}" placeholder="请输入您的电子邮箱" required>
                </div>
                
            </div>
            
            <div class="info-box" style="margin-top: 2rem;">
                <h3>模型参数配置</h3>
                <p>请选择不同类型，配置对应的模型参数默认值（生成过程中默认会使用这些参数，也可以在生成界面独立修改）。</p>
            </div>
            
            <!-- Tab 切换按钮 -->
            <div class="tab-buttons" style="margin-bottom: 1.5rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
                <button type="button" class="tab-btn" onclick="openTab(event, 'textToImage')" style="background-color: #4a6fa5; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">文生图</button>
                <button type="button" class="tab-btn" onclick="openTab(event, 'imageToImage')" style="background-color: #ccc; color: #333; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">图生图</button>
                <button type="button" class="tab-btn" onclick="openTab(event, 'textToVideo')" style="background-color: #ccc; color: #333; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">文生视频</button>
                <button type="button" class="tab-btn" onclick="openTab(event, 'imageToVideo')" style="background-color: #ccc; color: #333; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">图生视频</button>
            </div>
            
            <!-- 文生图 Tab 内容 -->
            <div id="textToImage" class="tab-content" style="display: block;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="margin-top: 0; margin-bottom: 0;">文生图参数</h3>
                    <button type="button" id="resetTextToImage" class="form-button" style="background-color: #f39c12; margin: 0;">恢复初始值</button>
                </div>
                
                <div class="grid-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <div class="form-group">
                        <label for="tti_width">生成图片宽度 <span style="color: red;">*</span></label>
                        <input type="number" id="tti_width" name="settings[text_to_image][width]" 
                               value="{{ settings.text_to_image.width }}" min="256" max="2048" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成图片的水平像素数，建议值: 1024</small>
                    </div>
                    <div class="form-group">
                        <label for="tti_height">生成图片高度 <span style="color: red;">*</span></label>
                        <input type="number" id="tti_height" name="settings[text_to_image][height]" 
                               value="{{ settings.text_to_image.height }}" min="256" max="2048" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成图片的垂直像素数，建议值: 1024</small>
                    </div>
                    <div class="form-group">
                        <label for="tti_steps">步数 <span style="color: red;">*</span></label>
                        <input type="number" id="tti_steps" name="settings[text_to_image][steps]" 
                               value="{{ settings.text_to_image.steps }}" min="1" max="100">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成过程中的迭代次数，值越高质量越好但速度越慢，建议值: 30-50</small>
                    </div>
                    <div class="form-group">
                        <label for="tti_cfg">提示引导强度（CFG Scale） <span style="color: red;">*</span></label>
                        <input type="number" id="tti_cfg" name="settings[text_to_image][cfg]" 
                               value="{{ settings.text_to_image.cfg }}" min="1" max="100" step="0.5">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成结果与提示词的匹配程度，值越高越严格，建议值: 7.5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="tti_batch_size">批量大小</label>
                        <input type="number" id="tti_batch_size" name="settings[text_to_image][batch_size]" 
                               value="{{ settings.text_to_image.batch_size }}" min="1" max="20">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">一次生成的图片数量，值越高消耗资源越多，建议值: 5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="tti_seed">随机种子 (-1表示随机)</label>
                        <input type="number" id="tti_seed" name="settings[text_to_image][seed]" 
                               value="{{ settings.text_to_image.seed }}" min="-1">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成过程的随机性，使用相同种子可复现相同结果，建议值: -1 (随机)</small>
                    </div>
                    <div class="form-group">
                        <label for="tti_denoise">降噪强度</label>
                        <input type="number" id="tti_denoise" name="settings[text_to_image][denoise]" 
                               value="{{ settings.text_to_image.denoise }}" min="0" max="1" step="0.05">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成图像的随机性，值越低越接近初始状态，建议值: 0.5-0.7</small>
                    </div>

                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label for="tti_prompt">默认提示词</label>
                    <textarea id="tti_prompt" name="settings[text_to_image][prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.text_to_image.prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">生成图片时使用的默认描述文本，可以在生成界面修改</small>
                </div>
                
                <div class="form-group">
                    <label for="tti_negative_prompt">默认负面提示词</label>
                    <textarea id="tti_negative_prompt" name="settings[text_to_image][negative_prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.text_to_image.negative_prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">用于避免生成不想要的内容，如: low quality, blurry, pixelated</small>
                </div>
            </div>
            
            <!-- 图生图 Tab 内容 -->
            <div id="imageToImage" class="tab-content" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="margin-top: 0; margin-bottom: 0;">图生图参数</h3>
                    <button type="button" id="resetImageToImage" class="form-button" style="background-color: #f39c12; margin: 0;">恢复初始值</button>
                </div>
                
                <div class="grid-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <div class="form-group">
                        <label for="iti_width">生成图片宽度 <span style="color: red;">*</span></label>
                        <input type="number" id="iti_width" name="settings[image_to_image][width]" 
                               value="{{ settings.image_to_image.width }}" min="256" max="2048" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成图片的水平像素数，建议值: 1024</small>
                    </div>
                    <div class="form-group">
                        <label for="iti_height">生成图片高度 <span style="color: red;">*</span></label>
                        <input type="number" id="iti_height" name="settings[image_to_image][height]" 
                               value="{{ settings.image_to_image.height }}" min="256" max="2048" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成图片的垂直像素数，建议值: 1024</small>
                    </div>
                    <div class="form-group">
                        <label for="iti_steps">步数 <span style="color: red;">*</span></label>
                        <input type="number" id="iti_steps" name="settings[image_to_image][steps]" 
                               value="{{ settings.image_to_image.steps }}" min="1" max="100">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成过程中的迭代次数，值越高质量越好但速度越慢，建议值: 30-50</small>
                    </div>
                    <div class="form-group">
                        <label for="iti_cfg">提示引导强度（CFG Scale） <span style="color: red;">*</span></label>
                        <input type="number" id="iti_cfg" name="settings[image_to_image][cfg]" 
                               value="{{ settings.image_to_image.cfg }}" min="1" max="100" step="0.5">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成结果与提示词的匹配程度，值越高越严格，建议值: 7.5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="iti_batch_size">批量大小</label>
                        <input type="number" id="iti_batch_size" name="settings[image_to_image][batch_size]" 
                               value="{{ settings.image_to_image.batch_size }}" min="1" max="20">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">一次生成的图片数量，值越高消耗资源越多，建议值: 5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="iti_seed">随机种子 (-1表示随机)</label>
                        <input type="number" id="iti_seed" name="settings[image_to_image][seed]" 
                               value="{{ settings.image_to_image.seed }}" min="-1">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成过程的随机性，使用相同种子可复现相同结果，建议值: -1 (随机)</small>
                    </div>
                    <div class="form-group">
                        <label for="iti_denoise">降噪强度</label>
                        <input type="number" id="iti_denoise" name="settings[image_to_image][denoise]" 
                               value="{{ settings.image_to_image.denoise }}" min="0" max="1" step="0.05">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制原图保留程度，值越低越接近原图，建议值: 0.5-0.7</small>
                    </div>

                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label for="iti_prompt">默认提示词</label>
                    <textarea id="iti_prompt" name="settings[image_to_image][prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.image_to_image.prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">生成图片时使用的默认描述文本，可以在生成界面修改</small>
                </div>
                
                <div class="form-group">
                    <label for="iti_negative_prompt">默认负面提示词</label>
                    <textarea id="iti_negative_prompt" name="settings[image_to_image][negative_prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.image_to_image.negative_prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">用于避免生成不想要的内容，如: low quality, blurry, pixelated</small>
                </div>
            </div>
            
            <!-- 文生视频 Tab 内容 -->
            <div id="textToVideo" class="tab-content" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="margin-top: 0; margin-bottom: 0;">文生视频参数</h3>
                    <button type="button" id="resetTextToVideo" class="form-button" style="background-color: #f39c12; margin: 0;">恢复初始值</button>
                </div>
                
                <div class="grid-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <div class="form-group">
                        <label for="ttv_width">生成视频宽度 <span style="color: red;">*</span></label>
                        <input type="number" id="ttv_width" name="settings[text_to_video][width]" 
                               value="{{ settings.text_to_video.width }}" min="256" max="1024" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频的水平像素数，建议值: 768</small>
                    </div>
                    <div class="form-group">
                        <label for="ttv_height">生成视频高度 <span style="color: red;">*</span></label>
                        <input type="number" id="ttv_height" name="settings[text_to_video][height]" 
                               value="{{ settings.text_to_video.height }}" min="256" max="1024" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频的垂直像素数，建议值: 576</small>
                    </div>
                    <div class="form-group">
                        <label for="ttv_length">生成视频长度（秒） <span style="color: red;">*</span></label>
                        <input type="number" id="ttv_length" name="settings[text_to_video][length]"
                               value="{{ settings.text_to_video.length }}" min="2" max="30" step="1">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频总时长，值越高速度越慢，建议值: 5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="ttv_steps">步数 <span style="color: red;">*</span></label>
                        <input type="number" id="ttv_steps" name="settings[text_to_video][steps]" 
                               value="{{ settings.text_to_video.steps }}" min="1" max="100">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成过程中的迭代次数，值越高质量越好但速度越慢，建议值: 30-50</small>
                    </div>
                     <div class="form-group">
                        <label for="ttv_cfg">提示引导强度（CFG Scale） <span style="color: red;">*</span></label>
                        <input type="number" id="ttv_cfg" name="settings[text_to_video][cfg]"
                               value="{{ settings.text_to_video.cfg }}" min="1" max="100" step="0.5">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成结果与提示词的匹配程度，值越高越严格，建议值: 7.5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="ttv_fps">帧率 <span style="color: red;">*</span></label>
                        <input type="number" id="ttv_fps" name="settings[text_to_video][fps]" 
                               value="{{ settings.text_to_video.fps }}" min="1" max="120" step="1">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">每秒显示的帧数，值越高视频越流畅速度越慢，建议值: 16</small>
                    </div>
                    {#<div class="form-group">
                        <label for="ttv_shift">帧移</label>
                        <input type="number" id="ttv_shift" name="settings[text_to_video][shift]" 
                               value="{{ settings.text_to_video.shift }}" min="1" max="32">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">视频生成过程中的帧移参数，影响视频流畅度，建议值: 8</small>
                    </div>#}
                    <div class="form-group">
                        <label for="ttv_batch_size">批次大小</label>
                        <input type="number" id="ttv_batch_size" name="settings[text_to_video][batch_size]" 
                               value="{{ settings.text_to_video.batch_size }}" min="1" max="10">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">每次生成的视频数量，建议值: 1</small>
                    </div>
                    <div class="form-group">
                        <label for="ttv_denoise">降噪强度</label>
                        <input type="number" id="ttv_denoise" name="settings[text_to_video][denoise]" 
                               value="{{ settings.text_to_video.denoise }}" min="0" max="1" step="0.01">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成过程中的降噪强度，影响视频清晰度，建议值: 0.55</small>
                    </div>
                    <div class="form-group">
                        <label for="ttv_seed">随机种子 (-1表示随机)</label>
                        <input type="number" id="ttv_seed" name="settings[text_to_video][seed]" 
                               value="{{ settings.text_to_video.seed }}" min="-1">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成过程的随机性，使用相同种子可复现相同结果，建议值: -1 (随机)</small>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label for="ttv_prompt">默认提示词</label>
                    <textarea id="ttv_prompt" name="settings[text_to_video][prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.text_to_video.prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频时使用的默认描述文本，可以在生成界面修改</small>
                </div>
                
                <div class="form-group">
                    <label for="ttv_negative_prompt">默认负面提示词</label>
                    <textarea id="ttv_negative_prompt" name="settings[text_to_video][negative_prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.text_to_video.negative_prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">用于避免生成不想要的内容，如: low quality, blurry, pixelated</small>
                </div>
            </div>
            
            <!-- 图生视频 Tab 内容 -->
            <div id="imageToVideo" class="tab-content" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="margin-top: 0; margin-bottom: 0;">图生视频参数</h3>
                    <button type="button" id="resetImageToVideo" class="form-button" style="background-color: #f39c12; margin: 0;">恢复初始值</button>
                </div>
                
                <div class="grid-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <div class="form-group">
                        <label for="itv_width">生成视频宽度 <span style="color: red;">*</span></label>
                        <input type="number" id="itv_width" name="settings[image_to_video][width]" 
                               value="{{ settings.image_to_video.width }}" min="256" max="1024" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频的水平像素数，建议值: 768</small>
                    </div>
                    <div class="form-group">
                        <label for="itv_height">生成视频高度 <span style="color: red;">*</span></label>
                        <input type="number" id="itv_height" name="settings[image_to_video][height]" 
                               value="{{ settings.image_to_video.height }}" min="256" max="1024" step="64">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频的垂直像素数，建议值: 576</small>
                    </div>
                    <div class="form-group">
                        <label for="itv_length">生成视频长度（秒） <span style="color: red;">*</span></label>
                        <input type="number" id="itv_length" name="settings[image_to_video][length]"
                               value="{{ settings.image_to_video.length }}" min="2" max="30">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频总时长，值越高速度越慢，建议值: 5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="itv_steps">步数 <span style="color: red;">*</span></label>
                        <input type="number" id="itv_steps" name="settings[image_to_video][steps]" 
                               value="{{ settings.image_to_video.steps }}" min="1" max="100">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成过程中的迭代次数，值越高质量越好但速度越慢，建议值: 30-50</small>
                    </div>
                    <div class="form-group">
                        <label for="itv_cfg">提示引导强度（CFG Scale） <span style="color: red;">*</span></label>
                        <input type="number" id="itv_cfg" name="settings[image_to_video][cfg]"
                               value="{{ settings.image_to_video.cfg }}" min="1" max="100" step="0.5">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成结果与提示词的匹配程度，值越高越严格，建议值: 7.5-10</small>
                    </div>
                    <div class="form-group">
                        <label for="itv_fps">帧率 <span style="color: red;">*</span></label>
                        <input type="number" id="itv_fps" name="settings[image_to_video][fps]" 
                               value="{{ settings.image_to_video.fps }}" min="1" max="120" step="1">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">每秒显示的帧数，值越高视频越流畅，建议值: 16</small>
                    </div>
                    {#<div class="form-group">
                        <label for="itv_shift">帧移</label>
                        <input type="number" id="itv_shift" name="settings[image_to_video][shift]" 
                               value="{{ settings.image_to_video.shift }}" min="1" max="32">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">视频生成过程中的帧移参数，影响视频流畅度，建议值: 8</small>
                    </div>#}
                    <div class="form-group">
                        <label for="itv_batch_size">批次大小</label>
                        <input type="number" id="itv_batch_size" name="settings[image_to_video][batch_size]" 
                               value="{{ settings.image_to_video.batch_size }}" min="1" max="10">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">每次生成的视频数量，建议值: 1</small>
                    </div>
                    <div class="form-group">
                        <label for="itv_denoise">降噪强度</label>
                        <input type="number" id="itv_denoise" name="settings[image_to_video][denoise]" 
                               value="{{ settings.image_to_video.denoise }}" min="0" max="1" step="0.01">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">生成过程中的降噪强度，影响视频清晰度，建议值: 0.6</small>
                    </div>
                    <div class="form-group">
                        <label for="itv_seed">随机种子 (-1表示随机)</label>
                        <input type="number" id="itv_seed" name="settings[image_to_video][seed]" 
                               value="{{ settings.image_to_video.seed }}" min="-1">
                        <small style="color: #666; display: block; margin-top: 0.25rem;">控制生成过程的随机性，使用相同种子可复现相同结果，建议值: -1 (随机)</small>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label for="itv_prompt">默认提示词</label>
                    <textarea id="itv_prompt" name="settings[image_to_video][prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.image_to_video.prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">生成视频时使用的默认描述文本，可以在生成界面修改</small>
                </div>
                
                <div class="form-group">
                    <label for="itv_negative_prompt">默认负面提示词</label>
                    <textarea id="itv_negative_prompt" name="settings[image_to_video][negative_prompt]" 
                              rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; box-sizing: border-box;">{{ settings.image_to_video.negative_prompt }}</textarea>
                    <small style="color: #666; display: block; margin-top: 0.25rem;">用于避免生成不想要的内容，如: low quality, blurry, pixelated</small>
                </div>
            </div>
            
            <button type="submit" class="form-button" style="margin-top: 2rem;">保存配置</button>
        </form>

        <a href="{{ url_for('index') }}" class="back-link">← 返回首页</a>
    </div>

    <script>
        // 恢复初始值功能
        document.getElementById('resetTextToImage').addEventListener('click', async function() {
            if (await showConfirmDialog('确定要恢复到【文生图】参数的初始值吗？当前设置将会丢失。')) {
                window.location.href = '/config/reset/text_to_image';
            }
        });
        
        document.getElementById('resetImageToImage').addEventListener('click', async function() {
            if (await showConfirmDialog('确定要恢复到【图生图】参数的初始值吗？当前设置将会丢失。')) {
                window.location.href = '/config/reset/image_to_image';
            }
        });
        
        document.getElementById('resetTextToVideo').addEventListener('click', async function() {
            if (await showConfirmDialog('确定要恢复到【文生视频】参数的初始值吗？当前设置将会丢失。')) {
                window.location.href = '/config/reset/text_to_video';
            }
        });
        
        document.getElementById('resetImageToVideo').addEventListener('click', async function() {
            if (await showConfirmDialog('确定要恢复到【图生视频】参数的初始值吗？当前设置将会丢失。')) {
                window.location.href = '/config/reset/image_to_video';
            }
        });
    </script>

    <!-- 引入公共组件 -->
    {% include 'components/notification.html' %}
    {% include 'components/task_queue_status.html' %}
    
    <!-- 引入任务模态框 -->
    {% include 'components/task_modal.html' %}
    
    <!-- 引入页脚组件 -->
    {% include 'components/footer.html' %}
    
    <script>
        // Tab 切换功能
        function openTab(evt, tabName) {
            // 隐藏所有 tab 内容
            var tabcontent = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            
            // 重置所有 tab 按钮样式
            var tablinks = document.getElementsByClassName("tab-btn");
            for (var i = 0; i < tablinks.length; i++) {
                tablinks[i].style.backgroundColor = "#ccc";
                tablinks[i].style.color = "#333";
            }
            
            // 显示当前 tab 内容并设置按钮样式
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.style.backgroundColor = "#4a6fa5";
            evt.currentTarget.style.color = "white";
        }
        
        // 参数说明功能
        document.addEventListener('DOMContentLoaded', function() {
            // 加载参数说明配置文件
            fetch('/configs/node_notes.json')
                .then(response => response.json())
                .then(paramExplanations => {
                    // 存储参数说明数据
                    window.paramExplanations = paramExplanations;
                    
                    // 为所有参数标签添加说明标签
                    addParamTooltips();
                })
                .catch(error => {
                    console.error('加载参数说明配置文件失败:', error);
                });
        });
        
        // 为参数标签添加说明标签
        function addParamTooltips() {
            // 查找所有的参数标签
            const paramLabels = document.querySelectorAll('.form-group label');
            
            paramLabels.forEach(label => {
                // 获取参数ID
                const forAttr = label.getAttribute('for');
                if (!forAttr) return;
                
                // 确定参数类型和名称
                let paramType = 'common';
                let paramName = forAttr;
                
                // 根据ID前缀判断参数所属类型
                if (forAttr.startsWith('tti_') || forAttr.startsWith('iti_')) {
                    paramType = 'to_image';
                    paramName = forAttr.substring(4);
                } else if (forAttr.startsWith('ttv_') || forAttr.startsWith('itv_')) {
                    paramType = 'to_video';
                    paramName = forAttr.substring(4);
                } else if (['comfyui_api_url', 'nickname', 'email'].includes(forAttr)) {
                    paramType = 'system';
                    paramName = forAttr;
                }
                
                // 获取参数说明
                let explanation = '';
                if (window.paramExplanations && window.paramExplanations[paramType] && window.paramExplanations[paramType][paramName]) {
                    explanation = window.paramExplanations[paramType][paramName];
                } else if (window.paramExplanations && window.paramExplanations.common && window.paramExplanations.common[paramName]) {
                    explanation = window.paramExplanations.common[paramName];
                }
                
                // 如果有说明，添加标签
                if (explanation) {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'param-tooltip';
                    tooltip.innerHTML = `
                        <div class="param-icon">?</div>
                        <div class="param-content">${explanation}</div>
                    `;
                    label.appendChild(tooltip);
                }
            });
        }
    </script>
</body>
</html>